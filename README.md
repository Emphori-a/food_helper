# Foodgram

## Описание.
Сайт для публикации рецептов. 
Возможности проекта:
- авторизованный пользователь может добавлять рецепты, редактировать и удалять свои рецепты,
- зарегистрированным пользователям также доступен сервис «Список покупок», который позволяет создавать список продуктов, которые нужно купить для приготовления выбранных блюд,
- авторизованные пользователи могут добавлять рецепты в избранное,
- авторизованные пользователи могут подписываться на публикации других авторов.
- неавторизованным пользователям доступен просмотр страниц: главной страницы, страниц рецептов, страниц пользователей.

Проект доступен по [адресу](https://yahwfobia.online/).  
Документация к API доступна по [адресу](https://yahwfobia.online/api/docs/).  

## Использованные технологии.
- Python 3.9.
- Django 3.2
- Django REST Framework 3.12
- Djoser 2.2
- PostgreSQL


## Запуск проекта.
Клонировать репозиторий
```
git clone https://github.com/Emphori-a/foodgram.git
```

1. Локальный запуск проекта.
- В папке infra создать файл .env со следующим содержимым:
```
POSTGRES_DB=<имя базы данных postgres>
POSTGRES_USER=<имя пользователя для БД>
POSTGRES_PASSWORD=<пароль пользователя для БД>
DB_HOST=<db>
DB_PORT=<5432>
SECRET_KEY=<секретный ключ проекта Django>
DEBUG=<True / False> # настройка для запуска проекта в режиме отладки
ALLOWED_HOSTS=<разрешенные хосты для запуска проекта>
NOT_IN_DEVELOP=<True / False> # при значении False проект будет запущен с БД sqlite 
```
- Находясь в папке infra выполнить командe для запуска контейнеров:
```
docker compose up -d
```

2. Запуск проекта на удаленном сервере.
- Установите докер на ваш сервер:
```
sudo apt install docker.io
```
- Установите docker-compose на ваш сервер:
```
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
```
- Установите необходимые разрешения для docker-compose:
```
sudo chmod +x /usr/local/bin/docker-compose
```
- Создайте папку foodgram на вашем сервере:
```
mkdir foodgram
```
- Создайте .env файл в этой папке:
```
cd foodgram/ && touch .env
```
- Наполните .env файл следующим содержимым:
```
POSTGRES_DB=<имя базы данных postgres>
POSTGRES_USER=<имя пользователя для БД>
POSTGRES_PASSWORD=<пароль пользователя для БД>
DB_HOST=<db>
DB_PORT=<5432>
SECRET_KEY=<секретный ключ проекта Django>
DEBUG=<True / False> # настройка для запуска проекта в режиме отладки
ALLOWED_HOSTS=<разрешенные хосты для запуска проекта>
NOT_IN_DEVELOP=<True / False> # при значении False проект будет запущен с БД sqlite 
```
- Для работы workflow добавьте в Secrets GitHub переменные окружения:
```
DOCKER_USERNAME=<имя пользователя в DockerHub>
DOCKER_PASSWORD=<пароль от DockerHub>
USER=<username для подключения к серверу>
HOST=<IP сервера>
PASSPHRASE=<пароль для сервера>
SSH_KEY=<ваш SSH ключ>
TELEGRAM_TO=<ID чата, в который придет сообщение>
TELEGRAM_TOKEN=<токен вашего бота>
```
- После запуска workflow:
    - код будет проверен на соответствие PEP8
    - на сервер будут скопированы папка infra и docs
    - будет собран и запушен образ бекенда на DockerHub
    - будет собран и запушен образ фронтенда на DockerHub
    - запустится деплой проекта на сервере
    - по окончании деплоя будет направлено сообщение в telegram об успешно деплое проекта

- При запуске контейнера бекенда:
    - применяются миграции
    - наполняется модель ингредиентов
    - наполняется модель тегов
    - собирается статика

### Наполнение БД.
Для наполнения БД в папку backend/foodgram/backend/data разместите csv или json-файлы с данными.
По умолчанию созданы файлы для наполнения таблицы ингредиентов и тегов.

- команда для наполнения БД из csv-файла:
```
python manage.py load_csv_data name_your_file.csv
```

- команда для наполнения БД из json-файла:
```
python manage.py load_json_data name_your_file.json
```

### API.
Подробна документация к API c доступна по [адресу](https://yahwfobia.online/api/docs/). 
Все запросы к API направляются на {your_host}/api/.  
Все запросы от имени пользователя должны выполняться с заголовком "Authorization: Token TOKENVALUE".

1. auth/ - поддерживает POST запросы.
- token/login/ - выдача токена для авторизации,
- token/logout/ - удаление токена текущего пользователя.

2. users/ - работа с пользователями:
Доступно любому пользователю:
- POST запрос для регистрации,
- GET запрос для получения списка пользователей,
- {id}/ - GET запрос, профиль указанного пользователя.
Доступно только авторизованному пользователю:
- me/ - GET запрос, профиль пользователя,
- me/avatar/ - PUT / DELETE запросы, для добавления / удаления своего аватара,
- set_password/ - POST запрос для изменения своего пароля,
- subscriptions/ - GET запрос, возвращает пользователей, на которых подписан текущий пользователь, в выдачу добавляются рецепты,
- {id}/subscribe/ - POST / DELETE запрос, позволяет подписаться / отписаться от пользователя.

3. tags/ - поддерживает GET запросы для любого пользователя:
- возвращает список тегов,
- {id}/ - возвращает информацию о конкретном теге.

4. ingredients/ - поддерживает GET запросы для любого пользователя:
- возвращает список ингредиентов, возможна фильтрация по полю name,
- {id}/ - возвращает информацию о конкретном ингредиенте.

5. recipes/ - работа с рецептами:
Доступно любому пользователю:
- GET запрос для получения списка рецептов, возможна фильтрация по полям: is_favorited, is_in_shopping_cart, author, tags,
- {id}/ - GET запрос, возвращает информацию о конкретном рецепте,
- {id}/get-link/ - GET запрос, возвращает короткую ссылку на рецепт.
Доступно только авторизованному пользователю:
- POST запрос для создания рецепта,
- {id}/ - PATCH запрос, обновляет информацию о конкретном рецепте, доступно только автору рецепта.
- {id}/ - DELETE запрос, удаляет рецепт, доступно только автору рецепта,
- {id}/shopping_cart/ - POST / DELETE запрос, позволяет добавить / удалить рецепт из своего списка покупок,
- {id}/favorite/ - POST / DELETE запрос, позволяет добавить / удалить рецепт из своего списка избранного,
- download_shopping_cart/ - GET запрос, позволяет скачать свой файл со списком покупок.

### Авторы, контактная информация.
Мартынова Валерия
* https://github.com/Emphori-a
* e-mail: emphoria@yandex.ru
* e-mail: Telegram: @Emphori


